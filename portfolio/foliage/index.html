<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Anton Karlsson ">
<meta name="description" content="Foliage SwapperIntroductionThe initial idea arose from wanting leaves falling from individual trees, which would mean the use of foliage actors.However, having an entire forest of foliage actors would not be feasible.And so this project was born, to swap between cheap instanced static meshes for more expensive actors within a set radius of the player.This way I could fully utilize Unreal&#39;s instanced static mesh system to reduce the amount of draw calls, but with the added benefit of having normal actors close to the player where it matters." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://karlsson-anton.github.io/portfolio/foliage/" />


    <title>
        
            Foliage Swapper :: Anton Karlsson 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.ae639df461630822f2a5e4f866d044c3db6ff7cbaf318a49d942a9ac492d7a8f.css">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Foliage Swapper">
<meta itemprop="description" content="Foliage SwapperIntroductionThe initial idea arose from wanting leaves falling from individual trees, which would mean the use of foliage actors.However, having an entire forest of foliage actors would not be feasible.And so this project was born, to swap between cheap instanced static meshes for more expensive actors within a set radius of the player.This way I could fully utilize Unreal&#39;s instanced static mesh system to reduce the amount of draw calls, but with the added benefit of having normal actors close to the player where it matters."><meta itemprop="datePublished" content="2022-04-13T05:08:22+02:00" />
<meta itemprop="dateModified" content="2022-04-13T05:08:22+02:00" />
<meta itemprop="wordCount" content="412">
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Foliage Swapper"/>
<meta name="twitter:description" content="Foliage SwapperIntroductionThe initial idea arose from wanting leaves falling from individual trees, which would mean the use of foliage actors.However, having an entire forest of foliage actors would not be feasible.And so this project was born, to swap between cheap instanced static meshes for more expensive actors within a set radius of the player.This way I could fully utilize Unreal&#39;s instanced static mesh system to reduce the amount of draw calls, but with the added benefit of having normal actors close to the player where it matters."/>








    <meta property="article:published_time" content="2022-04-13 05:08:22 &#43;0200 CEST" />











<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@100;200&family=Roboto:wght@100&display=swap" rel="stylesheet">
    </head>

    
    <body class="">

    
        <div class="container">
            <header class="header" id="myHeader">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
        <span class="logo__text" id="myText">Anton Karlsson</span>
        <span class="logo__subtext" id="mySubtext">Technical Artist | Technical Leveldesigner</span>
    </div>
</a>
        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner">
            

            <li class=""><a href="/">Showreel</a></li>
            

            <li class=""><a href="/portfolio/">Portfolio</a></li>
            

            <li class=""><a href="/resume/">Resumé</a></li>
            

            <li class=""><a href="/about/">About</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main aria-role="main">
        <div class="post-content">
            
<div class="project">
    <img src="/images/foliage/banner.webp"/>
    <h2>Foliage Swapper</h2>
    <div class="project-content">
        <div class="project-grid">
            <h3>Introduction</h3>
            <p>
                The initial idea arose from wanting leaves falling from individual trees, which would mean the use of foliage actors.
                However, having an entire forest of foliage actors would not be feasible.
            </p>
            <p>
                And so this project was born, to swap between cheap instanced static meshes for more expensive actors within a set radius of the player.
                <br>This way I could fully utilize Unreal's instanced static mesh system to reduce the amount of draw calls, but with the added benefit of having normal actors close to the player where it matters.
            </p>
        </div>
        <div class="project-grid">
            <h3>Features</h3>
            <p>
                • Reduced amount of drawcalls compared to foliage actors.<br>
                • All-in-one Blueprint Component with easy customizability.<br>
                • Flexible use, add particles, physics-based foliage and much more.
            </p>
        </div>
        <div class="project-grid">
            <h3>Getting & Saving Instance Data</h3>
            <p>
                Getting the data from each individual instance was trickier than I initially thought.
                To extract all the data I needed from "InstancedFoliageActor" I had to use collision hits.
                Therefore I had to use a sphere collider attached to the player.
                However, as Unreal only calculate collisions with the root component I had to make the blueprint its own actor, instanced by a seperate component on the player and set to the players location.
                Nevertheless I got the individual instance data, like foliage index and transform data.
                I save all this data as a blueprint Struct.
            </p>
        </div>
        <div>
            <img src="/images/foliage/instancedata.webp"/>
        </div>
        <div>
            <img src="/images/foliage/spawnactor.webp"/>
        </div>
        <div class="project-grid">
            <h3>Spawn Actor & Delete Instance</h3>
            <p>
                With the static mesh instance data saved I could proceed by spawning the associated Actor from a user controlled map, aka a dictionary.
                <br>The map allow the user to define what the instance should be replaced with.
                Adding the saved struct to a list of swapped foliage.
                <br>And finally deleting the static mesh instance using the instance index.
            </p>
        </div>
        <div class="project-grid">
            <h3>Read Saved Data & Swap Back</h3>
            <p>
                For each item in the swapped foliage list I then check if the distance to the actor is greater than than the value set by the user.
                <br>If it falls outside the distance I destroy the foliage actor, instantiate the correct static mesh using its saved transform to the "InstancedFoliageActor".
                Finally I remove the saved stuct from the list.
            </p>
        </div>
        <div>
            <img src="/images/foliage/swapback.webp"/>
        </div>
        <div>
            <img src="/images/foliage/conclusion.webp"/>
        </div>
        <div class="project-grid">
            <h3>Conclusion</h3>
            <p>
                Although I achieved what I set out to do in the end, I had to overcome some difficulties with how Unreal handles collision.
                <br>Namely how it only calculates collision hits with the root component.
                <br>If I had more time I would've liked to investigate if I could make it more compact using traces.
            </p>
            <p>
                Thank you for reading!
            </p>
            <h3>Credits</h3>
            <p>
                <a href="https://www.unrealengine.com/marketplace/en-US/product/rural-australia" target="_blank">Rural Australia</a> by Andrew Svanberg Hamilton
            </p>
        </div>
    </div>
</div>
        </div>
    </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__social">
                <div>
                    &nbsp; <a href="https://www.linkedin.com/in/karlsson-anton" target="_blank" rel="noopener" title="Linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a> &nbsp;&nbsp; <a href="mailto:an.kn94@gmail.com" target="_blank" rel="noopener" title="Email"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a> &nbsp;
                </div>
        </div>

        <div class="footer__content">
            <span>&copy; 2022</span>
            <span><a href="https://karlsson-anton.github.io">Anton Karlsson</a></span>
            
            
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </div>
    </div>
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.2d3d449fc0ff117f00ac91342a8f76cd5b710411d7a0254dbe75da3234d2f685d6a0c44cff60c414e90b6a149da8e4032c713c25e4e6838e2e3918dc0ad2e81c.js" integrity="sha512-LT1En8D/EX8ArJE0Ko92zVtxBBHXoCVNvnXaMjTS9oXWoMRM/2DEFOkLahSdqOQDLHE8JeTmg44uORjcCtLoHA=="></script>



<script>
    
    window.onscroll = function() {shrinkHeader()};

    
    var header = document.getElementById("myHeader");
    var text = document.getElementById("myText");
    var subtext = document.getElementById("mySubtext");

    function shrinkHeader() {
		if (document.body.scrollTop > 96 || document.documentElement.scrollTop > 96) {
            header.classList.add("shrink");
            text.classList.add("shrinkText");
            subtext.classList.add("shrinkSubtext");
		} else {
            header.classList.remove("shrink");
            text.classList.remove("shrinkText");
            subtext.classList.remove("shrinkSubtext");
		}
	}
</script>
    </body>
</html>
